<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gravice - 英文法ミニゲーム</title>

  <!-- Google Fonts: Noto Sans JP -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --saltwater: #257985;
      --lagoon: #5EA8A7;
      --whitewash: #FFFFFF;
      --raspberry: #FF4447;
    }

    body {
      margin: 0;
      font-family: 'Noto Sans JP', 'Arial', sans-serif;
      font-weight: 400;
      background-color: var(--whitewash);
      color: var(--saltwater);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background-color: var(--saltwater);
      color: var(--whitewash);
      padding: 1rem;
      text-align: center;
    }

    header h1 {
      font-weight: 700;
      margin: 0;
    }

    .container {
      flex: 1;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      text-align: center;
    }

    .title {
      font-size: 3rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    .description {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      font-weight: 400;
    }

    .game-button {
      display: block;
      width: 90%;
      max-width: 300px;
      margin: 0.7rem auto;
      background-color: var(--lagoon);
      color: var(--whitewash);
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s ease, background-color 0.3s ease;
    }

    .game-button:hover {
      background-color: var(--raspberry);
      transform: scale(1.05);
    }

    .game-button:active {
      transform: scale(0.95);
    }

    .game-screen {
      display: none;
    }

    .visible {
      display: block;
    }

    #gameContent {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #question {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    #translation, #category {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: var(--saltwater);
    }

    #answerInput {
      padding: 0.5rem;
      font-size: 1.1rem;
      width: 200px;
      margin-bottom: 1rem;
      border: 2px solid var(--saltwater);
      border-radius: 5px;
    }

    #feedback {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--raspberry);
    }

    #score, #timer {
      font-size: 1.2rem;
      margin: 0.5rem;
    }

    #resultScreen {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .selector {
      margin: 1rem auto;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }

    select {
      padding: 0.5rem;
      font-size: 1rem;
      border: 2px solid var(--saltwater);
      border-radius: 5px;
      background-color: var(--whitewash);
      color: var(--saltwater);
    }

    @media (max-width: 600px) {
      .title {
        font-size: 2.2rem;
      }

      .description {
        font-size: 1rem;
      }

      .game-button {
        font-size: 1rem;
        padding: 0.9rem;
      }

      #question {
        font-size: 1.3rem;
      }

      #translation, #category {
        font-size: 1rem;
      }

      #answerInput {
        width: 150px;
      }

      .selector {
        flex-direction: column;
        gap: 0.5rem;
      }

      select {
        width: 200px;
      }
    }
  </style>
</head>
<body>

  <!-- クリック音（実際のファイルは必要に応じて用意） -->
  <audio id="click-sound" src="./click.mp3" preload="auto"></audio>

  <header>
    <h1>Gravice</h1>
    <p>ミニゲームで英文法を楽しく学ぼう！</p>
  </header>

  <div class="container" id="home">
    <div class="title">ゲームを選ぼう</div>
    <div class="description">好きなゲームを選んで、英文法力をアップしよう！</div>
    <div class="selector">
      <select id="gradeSelector">
        <option value="all" selected>中学文法総復習</option>
        <option value="1">中学1年</option>
        <option value="2">中学2年</option>
        <option value="3">中学3年</option>
      </select>
      <select id="categorySelector">
        <option value="all" selected>すべての文法</option>
        <option value="be動詞">be動詞</option>
        <option value="一般動詞">一般動詞</option>
        <option value="疑問文・否定文">疑問文・否定文</option>
        <option value="代名詞">代名詞</option>
        <option value="命令文">命令文</option>
        <option value="感嘆文">感嘆文</option>
        <option value="現在進行形">現在進行形</option>
        <option value="can">can</option>
        <option value="短縮形">短縮形</option>
        <option value="複数形">複数形</option>
        <option value="過去形">過去形</option>
        <option value="未来表現">未来表現</option>
        <option value="助動詞">助動詞</option>
        <option value="比較">比較</option>
        <option value="不定詞">不定詞</option>
        <option value="動名詞">動名詞</option>
        <option value="There構文">There構文</option>
        <option value="疑問詞">疑問詞</option>
        <option value="現在完了">現在完了</option>
        <option value="受動態">受動態</option>
        <option value="関係代名詞">関係代名詞</option>
        <option value="間接疑問文">間接疑問文</option>
        <option value="現在分詞">現在分詞</option>
        <option value="過去分詞">過去分詞</option>
        <option value="接続詞">接続詞</option>
        <option value="仮定法">仮定法</option>
      </select>
    </div>
    <button class="game-button" onclick="startGame('fillInBlank')">穴埋めタイムアタック</button>
    <button class="game-button" onclick="startGame('grammarSniper')">文法スナイパー</button>
    <button class="game-button" onclick="startGame('shuffleChallenge')">並び替えチャレンジ</button>
    <button class="game-button"onclick="startGame('trueFalse')">〇×判定ゲーム</button>
  </div>

  <div class="container game-screen" id="gameScreen">
    <div id="gameTitle" class="title"></div>
    <div id="gameContent" class="description">
      <div id="score">スコア: 0</div>
      <div id="timer">残り時間: 60秒</div>
      <div id="question"></div>
      <div id="translation"></div>
      <div id="category"></div>
      <input type="text" id="answerInput" placeholder="回答を入力" />
      <button class="game-button" onclick="checkAnswer()">回答</button>
      <div id="feedback"></div>
      <div id="resultScreen">
        <div id="resultMessage" class="description"></div>
        <button class="game-button" onclick="startGame('fillInBlank')">もう一度プレイ</button>
        <button class="game-button" onclick="goHome()">ホームに戻る</button>
      </div>
    </div>
  </div>

  <script>
    const clickSound = document.getElementById('click-sound');
    let score = 0;
    let timeLeft = 60;
    let timerId;
    let currentQuestion = null;
    let filteredQuestions = [];

    // 問題データ（中学1〜3年の例文、日本語訳と学年を追加）
    const questions = [
      // 中1: be動詞
      { sentence: "She ___ a student.", answer: "is", category: "be動詞", translation: "彼女は学生です。", grade: "1" },
      { sentence: "They ___ in the park.", answer: "are", category: "be動詞", translation: "彼らは公園にいます。", grade: "1" },
      { sentence: "I ___ happy today.", answer: "am", category: "be動詞", translation: "私は今日幸せです。", grade: "1" },
      { sentence: "___ he a teacher?", answer: "Is", category: "be動詞", translation: "彼は教師ですか？", grade: "1" },
      { sentence: "We ___ tired.", answer: "aren’t", category: "be動詞", translation: "私たちは疲れていません。", grade: "1" },
      // 中1: 一般動詞
      { sentence: "I ___ soccer every day.", answer: "play", category: "一般動詞", translation: "私は毎日サッカーをします。", grade: "1" },
      { sentence: "He ___ chocolate.", answer: "likes", category: "一般動詞", translation: "彼はチョコレートが好きです。", grade: "1" },
      { sentence: "___ she study English?", answer: "Does", category: "一般動詞", translation: "彼女は英語を勉強しますか？", grade: "1" },
      { sentence: "We ___ watch TV.", answer: "don’t", category: "一般動詞", translation: "私たちはテレビを見ません。", grade: "1" },
      { sentence: "They ___ their grandparents on Sundays.", answer: "visit", category: "一般動詞", translation: "彼らは日曜日に祖父母を訪ねます。", grade: "1" },
      // 中1: 疑問文・否定文
      { sentence: "___ you like pizza?", answer: "Do", category: "疑問文・否定文", translation: "あなたはピザが好きですか？", grade: "1" },
      { sentence: "She ___ go to school on weekends.", answer: "doesn’t", category: "疑問文・否定文", translation: "彼女は週末に学校に行きません。", grade: "1" },
      { sentence: "___ it raining now?", answer: "Is", category: "疑問文・否定文", translation: "今、雨が降っていますか？", grade: "1" },
      { sentence: "He ___ coming to the party.", answer: "isn’t", category: "疑問文・否定文", translation: "彼はパーティーに来ません。", grade: "1" },
      { sentence: "___ Tom play tennis?", answer: "Does", category: "疑問文・否定文", translation: "トムはテニスをしますか？", grade: "1" },
      // 中1: 代名詞・命令文・感嘆文
      { sentence: "___ me the book.", answer: "Give", category: "命令文", translation: "その本を私にください。", grade: "1" },
      { sentence: "___ a beautiful flower!", answer: "What", category: "感嘆文", translation: "なんて美しい花でしょう！", grade: "1" },
      { sentence: "This is ___ bag.", answer: "my", category: "代名詞", translation: "これは私のバッグです。", grade: "1" },
      { sentence: "___ run in the classroom.", answer: "Don’t", category: "命令文", translation: "教室で走らないで。", grade: "1" },
      { sentence: "___ cute the puppy is!", answer: "How", category: "感嘆文", translation: "その子犬、なんてかわいいんだ！", grade: "1" },
      // 中1: 現在進行形・can
      { sentence: "I ___ reading a book now.", answer: "am", category: "現在進行形", translation: "私は今、本を読んでいます。", grade: "1" },
      { sentence: "She ___ swim very well.", answer: "can", category: "can", translation: "彼女はとても上手に泳げます。", grade: "1" },
      { sentence: "They ___ playing soccer in the park.", answer: "are", category: "現在進行形", translation: "彼らは公園でサッカーをしています。", grade: "1" },
      { sentence: "___ you help me?", answer: "Can", category: "can", translation: "私を助けられますか？", grade: "1" },
      { sentence: "He ___ running fast.", answer: "is", category: "現在進行形", translation: "彼は速く走っています。", grade: "1" },
      // 中1: 短縮形・複数形
      { sentence: "___ a student.", answer: "I’m", category: "短縮形", translation: "私は学生です。", grade: "1" },
      { sentence: "There are two ___ in the house.", answer: "cats", category: "複数形", translation: "家に猫が2匹います。", grade: "1" },
      { sentence: "She ___ like coffee.", answer: "doesn’t", category: "短縮形", translation: "彼女はコーヒーが好きではありません。", grade: "1" },
      { sentence: "I have three ___.", answer: "books", category: "複数形", translation: "私は本を3冊持っています。", grade: "1" },
      { sentence: "They ___ here.", answer: "aren’t", category: "短縮形", translation: "彼らはここにいません。", grade: "1" },
      // 中2: 過去形
      { sentence: "I ___ to the zoo yesterday.", answer: "went", category: "過去形", translation: "昨日、動物園に行きました。", grade: "2" },
      { sentence: "She ___ a new dress.", answer: "bought", category: "過去形", translation: "彼女は新しいドレスを買いました。", grade: "2" },
      { sentence: "Did you ___ the movie?", answer: "see", category: "過去形", translation: "その映画を見ましたか？", grade: "2" },
      { sentence: "We ___ play soccer last week.", answer: "didn’t", category: "過去形", translation: "先週、私たちはサッカーをしませんでした。", grade: "2" },
      { sentence: "He ___ tired after school.", answer: "was", category: "過去形", translation: "彼は学校の後で疲れていました。", grade: "2" },
      // 中2: 未来表現
      { sentence: "I ___ call you later.", answer: "will", category: "未来表現", translation: "後であなたに電話します。", grade: "2" },
      { sentence: "She ___ going to visit her grandma tomorrow.", answer: "is", category: "未来表現", translation: "彼女は明日、祖母を訪ねるつもりです。", grade: "2" },
      { sentence: "___ you come to the party?", answer: "Will", category: "未来表現", translation: "あなたはパーティーに来ますか？", grade: "2" },
      { sentence: "They ___ going to study English tonight.", answer: "are", category: "未来表現", translation: "彼らは今夜、英語を勉強するつもりです。", grade: "2" },
      { sentence: "It ___ rain this afternoon.", answer: "will", category: "未来表現", translation: "今日の午後、雨が降るでしょう。", grade: "2" },
      // 中2: 助動詞
      { sentence: "You ___ finish your homework.", answer: "must", category: "助動詞", translation: "あなたは宿題を終わらせなければなりません。", grade: "2" },
      { sentence: "I ___ to clean my room.", answer: "have", category: "助動詞", translation: "私は部屋を掃除しなければなりません。", grade: "2" },
      { sentence: "She ___ be quiet in the library.", answer: "must", category: "助動詞", translation: "彼女は図書館で静かにしなければなりません。", grade: "2" },
      { sentence: "We ___ have to go to school tomorrow.", answer: "don’t", category: "助動詞", translation: "私たちは明日、学校に行かなくてもいいです。", grade: "2" },
      { sentence: "He ___ study harder.", answer: "should", category: "助動詞", translation: "彼はもっと一生懸命勉強すべきです。", grade: "2" },
      // 中2: 比較
      { sentence: "This book is ___ interesting than that one.", answer: "more", category: "比較", translation: "この本はあの本より面白いです。", grade: "2" },
      { sentence: "She is the ___ girl in the class.", answer: "tallest", category: "比較", translation: "彼女はクラスで一番背が高い女の子です。", grade: "2" },
      { sentence: "My bag is ___ than yours.", answer: "heavier", category: "比較", translation: "私のバッグはあなたのより重いです。", grade: "2" },
      { sentence: "This is the ___ beautiful park in the city.", answer: "most", category: "比較", translation: "これは市内で一番美しい公園です。", grade: "2" },
      { sentence: "He runs ___ than his brother.", answer: "faster", category: "比較", translation: "彼は兄より速く走ります。", grade: "2" },
      // 中2: 不定詞
      { sentence: "I want ___ learn English.", answer: "to", category: "不定詞", translation: "私は英語を学びたいです。", grade: "2" },
      { sentence: "This is a good book ___ read.", answer: "to", category: "不定詞", translation: "これは読むのに良い本です。", grade: "2" },
      { sentence: "She came here ___ meet her friend.", answer: "to", category: "不定詞", translation: "彼女は友達に会うためにここに来ました。", grade: "2" },
      { sentence: "He needs a pen ___ write with.", answer: "to", category: "不定詞", translation: "彼は書くためのペンが必要です。", grade: "2" },
      { sentence: "I study hard ___ pass the test.", answer: "to", category: "不定詞", translation: "私はテストに合格するために一生懸命勉強します。", grade: "2" },
      // 中2: 動名詞・There構文・疑問詞
      { sentence: "I enjoy ___ soccer.", answer: "playing", category: "動名詞", translation: "私はサッカーを楽しんでいます。", grade: "2" },
      { sentence: "___ is a cat in the garden.", answer: "There", category: "There構文", translation: "庭に猫がいます。", grade: "2" },
      { sentence: "___ is your name?", answer: "What", category: "疑問詞", translation: "あなたの名前は何ですか？", grade: "2" },
      { sentence: "She likes ___ songs.", answer: "singing", category: "動名詞", translation: "彼女は歌うのが好きです。", grade: "2" },
      { sentence: "___ do you live?", answer: "Where", category: "疑問詞", translation: "あなたはどこに住んでいますか？", grade: "2" },
      // 中3: 現在完了
      { sentence: "I ___ lived here for five years.", answer: "have", category: "現在完了", translation: "私はここに5年間住んでいます。", grade: "3" },
      { sentence: "She ___ been to Paris twice.", answer: "has", category: "現在完了", translation: "彼女はパリに2回行ったことがあります。", grade: "3" },
      { sentence: "We ___ just finished our homework.", answer: "have", category: "現在完了", translation: "私たちはちょうど宿題を終えました。", grade: "3" },
      { sentence: "He ___ lost his keys.", answer: "has", category: "現在完了", translation: "彼は鍵をなくしました。", grade: "3" },
      { sentence: "They ___ known each other since childhood.", answer: "have", category: "現在完了", translation: "彼らは子どもの頃からお互いを知っています。", grade: "3" },
      // 中3: 受動態
      { sentence: "This book ___ written by a famous author.", answer: "was", category: "受動態", translation: "この本は有名な作家によって書かれました。", grade: "3" },
      { sentence: "The room ___ cleaned every day.", answer: "is", category: "受動態", translation: "その部屋は毎日掃除されています。", grade: "3" },
      { sentence: "The cake ___ eaten by the children.", answer: "was", category: "受動態", translation: "そのケーキは子供たちに食べられました。", grade: "3" },
      { sentence: "English ___ spoken all over the world.", answer: "is", category: "受動態", translation: "英語は世界中で話されています。", grade: "3" },
      { sentence: "The house ___ be painted next week.", answer: "will", category: "受動態", translation: "その家は来週、塗装される予定です。", grade: "3" },
      // 中3: 関係代名詞
      { sentence: "This is the boy ___ helped me.", answer: "who", category: "関係代名詞", translation: "これは私を助けてくれた少年です。", grade: "3" },
      { sentence: "The book ___ I read was interesting.", answer: "which", category: "関係代名詞", translation: "私が読んだ本は面白かったです。", grade: "3" },
      { sentence: "She is the girl ___ bag is red.", answer: "whose", category: "関係代名詞", translation: "彼女はバッグが赤い女の子です。", grade: "3" },
      { sentence: "The park ___ we played is beautiful.", answer: "where", category: "関係代名詞", translation: "私たちが遊んだ公園は美しいです。", grade: "3" },
      { sentence: "I know the man ___ lives next door.", answer: "who", category: "関係代名詞", translation: "私は隣に住んでいる男性を知っています。", grade: "3" },
      // 中3: 間接疑問文・分詞
      { sentence: "I wonder ___ she lives.", answer: "where", category: "間接疑問文", translation: "彼女はどこに住んでいるのかな。", grade: "3" },
      { sentence: "The ___ cat is cute.", answer: "sleeping", category: "現在分詞", translation: "寝ている猫はかわいいです。", grade: "3" },
      { sentence: "The ___ chair is in the room.", answer: "broken", category: "過去分詞", translation: "壊れた椅子が部屋にあります。", grade: "3" },
      { sentence: "Do you know ___ time it is?", answer: "what", category: "間接疑問文", translation: "今何時か知っていますか？", grade: "3" },
      { sentence: "The ___ bird is beautiful.", answer: "singing", category: "現在分詞", translation: "歌っている鳥は美しいです。", grade: "3" },
      // 中3: 接続詞・仮定法
      { sentence: "I’ll call you ___ I have time.", answer: "if", category: "接続詞", translation: "時間があるときにあなたに電話します。", grade: "3" },
      { sentence: "___ I were rich, I would travel the world.", answer: "If", category: "仮定法", translation: "もし私がお金持ちだったら、世界中を旅します。", grade: "3" },
      { sentence: "She was tired, ___ she finished her work.", answer: "but", category: "接続詞", translation: "彼女は疲れていましたが、仕事を終えました。", grade: "3" },
      { sentence: "___ it rains, we won’t go out.", answer: "If", category: "仮定法", translation: "もし雨が降ったら、私たちは出かけません。", grade: "3" },
      { sentence: "I’ll help you ___ you need it.", answer: "because", category: "接続詞", translation: "あなたが必要なら、私は助けます。", grade: "3" }
    ];

    // 文法カテゴリーのリスト（初期表示用）
    const allCategories = [
      { value: "all", text: "すべての文法" },
      { value: "be動詞", text: "be動詞" },
      { value: "一般動詞", text: "一般動詞" },
      { value: "疑問文・否定文", text: "疑問文・否定文" },
      { value: "代名詞", text: "代名詞" },
      { value: "命令文", text: "命令文" },
      { value: "感嘆文", text: "感嘆文" },
      { value: "現在進行形", text: "現在進行形" },
      { value: "can", text: "can" },
      { value: "短縮形", text: "短縮形" },
      { value: "複数形", text: "複数形" },
      { value: "過去形", text: "過去形" },
      { value: "未来表現", text: "未来表現" },
      { value: "助動詞", text: "助動詞" },
      { value: "比較", text: "比較" },
      { value: "不定詞", text: "不定詞" },
      { value: "動名詞", text: "動名詞" },
      { value: "There構文", text: "There構文" },
      { value: "疑問詞", text: "疑問詞" },
      { value: "現在完了", text: "現在完了" },
      { value: "受動態", text: "受動態" },
      { value: "関係代名詞", text: "関係代名詞" },
      { value: "間接疑問文", text: "間接疑問文" },
      { value: "現在分詞", text: "現在分詞" },
      { value: "過去分詞", text: "過去分詞" },
      { value: "接続詞", text: "接続詞" },
      { value: "仮定法", text: "仮定法" }
    ];

    function playSound() {
      if (clickSound) {
        clickSound.currentTime = 0;
        clickSound.play().catch((e) => {
          console.warn("クリック音の再生に失敗しました:", e);
        });
      }
    }

    function updateCategoryOptions() {
      const grade = document.getElementById('gradeSelector').value;
      const categorySelector = document.getElementById('categorySelector');
      categorySelector.innerHTML = ''; // 既存のオプションをクリア

      // 学年に基づいて利用可能なカテゴリーをフィルタリング
      let availableCategories = allCategories;
      if (grade !== 'all') {
        const validCategories = [...new Set(questions.filter(q => q.grade === grade).map(q => q.category))];
        availableCategories = allCategories.filter(cat => cat.value === 'all' || validCategories.includes(cat.value));
      }

      // カテゴリーオプションを追加
      availableCategories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat.value;
        option.text = cat.text;
        if (cat.value === 'all') {
          option.selected = true; // デフォルトで「すべての文法」を選択
        }
        categorySelector.appendChild(option);
      });
    }

    function startGame(gameId) {
      playSound();
      document.getElementById('home').style.display = 'none';
      const gameScreen = document.getElementById('gameScreen');
      gameScreen.classList.add('visible');

      const titles = {
        fillInBlank: '穴埋めタイムアタック',
        grammarSniper: '文法スナイパー',
        shuffleChallenge: '並び替えチャレンジ',
        trueFalse: '〇×判定ゲーム'
      };

      document.getElementById('gameTitle').innerText = titles[gameId];
      if (gameId === 'fillInBlank') {
        startFillInBlank();
      } else {
        document.getElementById('gameContent').innerText = `（ここに「${titles[gameId]}」の問題が表示されます）`;
      }
    }

    function goHome() {
      playSound();
      clearInterval(timerId);
      document.getElementById('gameScreen').classList.remove('visible');
      document.getElementById('home').style.display = 'block';
      resetGame();
    }

    function startFillInBlank() {
      score = 0;
      timeLeft = 60;
      document.getElementById('score').innerText = `スコア: ${score}`;
      document.getElementById('timer').innerText = `残り時間: ${timeLeft}秒`;
      document.getElementById('resultScreen').style.display = 'none';
      document.getElementById('answerInput').style.display = 'block';
      document.getElementById('answerInput').value = '';
      document.getElementById('feedback').innerText = '';
      document.querySelector('.game-button[onclick="checkAnswer()"]').style.display = 'block';

      // 選択された学年とカテゴリーに基づいて問題をフィルタリング
      const grade = document.getElementById('gradeSelector').value;
      const category = document.getElementById('categorySelector').value;
      filteredQuestions = questions.filter(q => {
        if (grade === 'all' && category === 'all') return true;
        if (grade !== 'all' && category === 'all') return q.grade === grade;
        if (grade === 'all' && category !== 'all') return q.category === category;
        return q.grade === grade && q.category === category;
      });

      if (filteredQuestions.length === 0) {
        document.getElementById('question').innerText = '選択した条件に合う問題がありません。';
        document.getElementById('translation').innerText = '';
        document.getElementById('category').innerText = '';
        document.getElementById('answerInput').style.display = 'none';
        document.querySelector('.game-button[onclick="checkAnswer()"]').style.display = 'none';
        return;
      }

      nextQuestion();
      startTimer();
    }

    function nextQuestion() {
      if (filteredQuestions.length === 0) {
        document.getElementById('question').innerText = '問題がありません。';
        return;
      }
      const randomIndex = Math.floor(Math.random() * filteredQuestions.length);
      currentQuestion = filteredQuestions[randomIndex];
      document.getElementById('question').innerText = currentQuestion.sentence;
      document.getElementById('translation').innerText = `日本語訳: ${currentQuestion.translation}`;
      document.getElementById('category').innerText = `文法: ${currentQuestion.category}`;
      document.getElementById('answerInput').value = '';
      document.getElementById('answerInput').focus();
    }

    function checkAnswer() {
      playSound();
      const userAnswer = document.getElementById('answerInput').value.trim().toLowerCase();
      const correctAnswer = currentQuestion.answer.toLowerCase();
      const feedback = document.getElementById('feedback');

      if (userAnswer === correctAnswer) {
        score += 10;
        document.getElementById('score').innerText = `スコア: ${score}`;
        feedback.innerText = '正解！';
        feedback.style.color = 'green';
        setTimeout(() => {
          feedback.innerText = '';
          nextQuestion();
        }, 1000);
      } else {
        feedback.innerText = `不正解！正解は「${currentQuestion.answer}」です。`;
        feedback.style.color = 'var(--raspberry)';
        setTimeout(() => {
          feedback.innerText = '';
          nextQuestion();
        }, 1500);
      }
    }

    function startTimer() {
      timerId = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerText = `残り時間: ${timeLeft}秒`;
        if (timeLeft <= 0) {
          clearInterval(timerId);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      document.getElementById('question').innerText = '';
      document.getElementById('translation').innerText = '';
      document.getElementById('category').innerText = '';
      document.getElementById('answerInput').style.display = 'none';
      document.querySelector('.game-button[onclick="checkAnswer()"]').style.display = 'none';
      document.getElementById('feedback').innerText = '';
      document.getElementById('resultScreen').style.display = 'flex';
      document.getElementById('resultMessage').innerText = `ゲーム終了！あなたのスコアは ${score} 点（${score / 10} 問正解）です！`;
    }

    function resetGame() {
      score = 0;
      timeLeft = 60;
      currentQuestion = null;
      filteredQuestions = [];
      document.getElementById('score').innerText = `スコア: ${score}`;
      document.getElementById('timer').innerText = `残り時間: ${timeLeft}秒`;
      document.getElementById('question').innerText = '';
      document.getElementById('translation').innerText = '';
      document.getElementById('category').innerText = '';
      document.getElementById('answerInput').value = '';
      document.getElementById('feedback').innerText = '';
      document.getElementById('resultScreen').style.display = 'none';
      document.getElementById('answerInput').style.display = 'block';
      document.querySelector('.game-button[onclick="checkAnswer()"]').style.display = 'block';
    }

    // 学年選択時にカテゴリーオプションを更新
    document.getElementById('gradeSelector').addEventListener('change', () => {
      updateCategoryOptions();
      playSound();
    });

    // 初期カテゴリーオプションを設定
    updateCategoryOptions();

    // Enterキーで回答送信
    document.getElementById('answerInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkAnswer();
      }
    });
  </script>
</body>
</html>